# æ•°æ®è·å–æ¨¡å—é‡æ„è¯´æ˜

## ğŸ“‹ é‡æ„æ¦‚è¿°

æœ¬æ¬¡é‡æ„æ•´åˆäº†åŸæœ‰çš„ `stock_base_info.py` å’Œ `data_getter.py` ä¸¤ä¸ªæ¨¡å—ï¼Œå°†ä¸ªè‚¡åŸºæœ¬ä¿¡æ¯å’Œè¡Œæƒ…æ•°æ®è·å–åŠŸèƒ½åˆå¹¶åˆ°ä¸€ä¸ªç»Ÿä¸€çš„æ¥å£ä¸­ã€‚

## ğŸ—ï¸ ä¸»è¦å˜æ›´

### 1. æ¨¡å—æ•´åˆ
- å°† `StockBaseInfos` ç±»åŠŸèƒ½æ•´åˆåˆ° `DataGetter` ç±»ä¸­
- ç»Ÿä¸€çš„æ•°æ®è·å–æ¥å£å’Œç¼“å­˜æœºåˆ¶

### 2. æ•°æ®å­—æ®µæ ‡å‡†åŒ–

#### ä¸ªè‚¡åŸºæœ¬ä¿¡æ¯å­—æ®µ
```python
# å¿…é€‰å­—æ®µ
STOCK_BASIC_REQUIRED = ['code', 'name']

# å¯é€‰å­—æ®µ
STOCK_BASIC_OPTIONAL = ['total_mv', 'cir_mv', 'pe', 'pb', 'total_shares', 'cir_shares']
```

#### è¡Œæƒ…æ•°æ®å­—æ®µ
```python
# å¿…é€‰å­—æ®µ
MARKET_DATA_REQUIRED = ['datetime', 'open', 'high', 'low', 'close', 'volume', 'amount', 'pre_close']
```

### 3. æ•°æ®æ ¼å¼ç»Ÿä¸€
- æ‰€æœ‰æ•°æ®å‡ä½¿ç”¨ `pandas.DataFrame` æ ¼å¼
- è¡Œæƒ…æ•°æ®ä»¥ `datetime` åˆ—ä½œä¸ºç´¢å¼•

### 4. ç¼“å­˜ç›®å½•è°ƒæ•´
- åŸç¼“å­˜ç›®å½•: `/tmp/cache_output/online/`
- æ–°ç¼“å­˜ç›®å½•: `/tmp/cache_output/quantara/data_getter/`

## ğŸ”§ API æ¥å£

### DataGetter ç±»

#### åˆå§‹åŒ–
```python
from common.data_getter import DataGetter

getter = DataGetter(xtdata_dir=r'G:\å›½é‡‘è¯åˆ¸QMTäº¤æ˜“ç«¯\datadir')
```

#### è‚¡ç¥¨ä»£ç æ ¼å¼æ”¯æŒ
DataGetter æ”¯æŒå¤šç§è‚¡ç¥¨ä»£ç è¾“å…¥æ ¼å¼ï¼Œå†…éƒ¨ç»Ÿä¸€è½¬æ¢ä¸º6ä½æ•°å­—æ ¼å¼ï¼š

```python
# æ”¯æŒçš„è¾“å…¥æ ¼å¼
'000001.SH'   -> '000001'
'SH000001'    -> '000001'
'000001sh'    -> '000001'
'sh000001'    -> '000001'
'000001'      -> '000001'
```

æ‰€æœ‰è¿”å›çš„æ•°æ®å­—å…¸çš„keyéƒ½ä½¿ç”¨åŸå§‹è¾“å…¥æ ¼å¼ã€‚

#### è·å–ä¸ªè‚¡åŸºæœ¬ä¿¡æ¯
```python
# è·å–å…¨éƒ¨Aè‚¡åŸºæœ¬ä¿¡æ¯
all_stocks = getter.get_stock_basic_info()

# è·å–æŒ‡å®šè‚¡ç¥¨çš„åŸºæœ¬ä¿¡æ¯
specific_stocks = getter.get_stock_basic_info(['000001', '600000'])

# å¼ºåˆ¶åˆ·æ–°ç¼“å­˜
fresh_data = getter.get_stock_basic_info(refresh=True)
```

#### è·å–è¡Œæƒ…æ•°æ®
```python
# è·å–æ—¥Kçº¿æ•°æ®
daily_data = getter.get_market_data('000001', period='1d', count=100)

# è·å–åˆ†é’Ÿçº¿æ•°æ®
minute_data = getter.get_market_data('000001', period='1m', count=240)

# è·å–å¤šåªè‚¡ç¥¨æ•°æ®
multi_data = getter.get_market_data(['000001', '600000'], period='1d', count=50)
```

#### è·å–å®æ—¶æ•°æ®
```python
# è·å–å®æ—¶è¡Œæƒ…
real_time = getter.get_real_time_data('000001')
```

#### è·å–æ¿å—ä¿¡æ¯
```python
# è·å–è‚¡ç¥¨æ‰€å±æ¿å—
sector_info = getter.get_stock_sector_info('000001')
```

#### è·å–æœ€æ–°äº¤æ˜“æ—¥æ•°æ®
```python
# è·å–æœ€æ–°äº¤æ˜“æ—¥å…¨å¤©åˆ†é’Ÿçº¿
latest_day_data = getter.get_latest_trading_day_market_data('000001', period='1m')
```

## ğŸ“Š æ•°æ®æ ¼å¼è¯´æ˜

### ä¸ªè‚¡åŸºæœ¬ä¿¡æ¯ DataFrame
```python
# DataFrame ç»“æ„
df = pd.DataFrame({
    'code': ['000001', '600000'],  # è‚¡ç¥¨ä»£ç ï¼ˆå¿…é€‰ï¼‰
    'name': ['å¹³å®‰é“¶è¡Œ', 'æµ¦å‘é“¶è¡Œ'],  # è‚¡ç¥¨åç§°ï¼ˆå¿…é€‰ï¼‰
    'total_mv': [123456.78, 234567.89],  # æ€»å¸‚å€¼ï¼ˆå¯é€‰ï¼‰
    'cir_mv': [98765.43, 198765.43],    # æµé€šå¸‚å€¼ï¼ˆå¯é€‰ï¼‰
    'pe': [8.5, 7.2],  # å¸‚ç›ˆç‡ï¼ˆå¯é€‰ï¼‰
    'pb': [0.85, 0.72],  # å¸‚å‡€ç‡ï¼ˆå¯é€‰ï¼‰
    'total_shares': [None, None],  # æ€»è‚¡æœ¬ï¼ˆå¯é€‰ï¼Œåç»­æ‰©å±•ï¼‰
    'cir_shares': [None, None]     # æµé€šè‚¡æœ¬ï¼ˆå¯é€‰ï¼Œåç»­æ‰©å±•ï¼‰
})
```

### è¡Œæƒ…æ•°æ® DataFrame
```python
# DataFrame ç»“æ„ï¼ˆdatetime ä½œä¸ºç´¢å¼•ï¼‰
df = pd.DataFrame({
    'open': [10.50, 10.75],      # å¼€ç›˜ä»·
    'high': [10.80, 10.90],      # æœ€é«˜ä»·
    'low': [10.45, 10.60],       # æœ€ä½ä»·
    'close': [10.75, 10.85],     # æ”¶ç›˜ä»·
    'volume': [12345678, 15678901],  # æˆäº¤é‡
    'amount': [134567890.12, 170123456.78],  # æˆäº¤é¢
    'pre_close': [10.45, 10.75]  # å‰æ”¶ç›˜ä»·
}, index=pd.to_datetime(['2024-01-01', '2024-01-02']))
```

## ğŸ—‚ï¸ ç¼“å­˜æœºåˆ¶

### ç¼“å­˜ç›®å½•ç»“æ„
```
/tmp/cache_output/quantara/data_getter/
â”œâ”€â”€ stock_basic_all_stocks.pkl          # ä¸ªè‚¡åŸºæœ¬ä¿¡æ¯ç¼“å­˜
â”œâ”€â”€ YYYYMMDD/                          # æŒ‰æ—¥æœŸç»„ç»‡çš„è¡Œæƒ…æ•°æ®ç¼“å­˜
â”‚   â”œâ”€â”€ market_data_000001_1d_100.pkl
â”‚   â”œâ”€â”€ market_data_600000_1m_240.pkl
â”‚   â””â”€â”€ ...
â””â”€â”€ sector_info_000001.pkl             # æ¿å—ä¿¡æ¯ç¼“å­˜
```

### ç¼“å­˜ç­–ç•¥
- **ä¸ªè‚¡åŸºæœ¬ä¿¡æ¯**: 24å°æ—¶è¿‡æœŸ
- **è¡Œæƒ…æ•°æ®**: æŒ‰æ—¥æœŸç¼“å­˜ï¼Œå½“æ—¥æ•°æ®ä¸è¿‡æœŸ
- **æ¿å—ä¿¡æ¯**: 24å°æ—¶è¿‡æœŸ

### ç¼“å­˜ç®¡ç†
```python
# æ¸…ç†è¿‡æœŸç¼“å­˜
getter.clear_cache(older_than_hours=48)

# æ¸…ç†ç‰¹å®šç±»å‹ç¼“å­˜
getter.clear_cache(cache_type='market_data')

# æ¸…ç†æ‰€æœ‰ç¼“å­˜
getter.clear_cache()
```

## ğŸ”„ å‘åå…¼å®¹

ä¸ºäº†ä¿æŒå‘åå…¼å®¹æ€§ï¼Œæä¾›ä»¥ä¸‹åˆ«åï¼š
```python
from common.data_getter import StockBasicInfo  # ç­‰åŒäº DataGetter
```

## ğŸ§ª æµ‹è¯•

è¿è¡Œæµ‹è¯•è„šæœ¬éªŒè¯åŠŸèƒ½ï¼š
```bash
python common/test_data_getter.py
```

## ğŸ“ æ³¨æ„äº‹é¡¹

1. **ä¾èµ–è¦æ±‚**:
   - pandas
   - numpy
   - akshare
   - xtquant (å¯é€‰ï¼Œç”¨äºè¡Œæƒ…æ•°æ®)

2. **ç¯å¢ƒé…ç½®**:
   - xtdataæ•°æ®ç›®å½•éœ€è¦æ­£ç¡®é…ç½®
   - ç¼“å­˜ç›®å½•ä¼šè‡ªåŠ¨åˆ›å»º

3. **é”™è¯¯å¤„ç†**:
   - ç½‘ç»œè¯·æ±‚å¤±è´¥æ—¶ä¼šè‡ªåŠ¨é‡è¯•
   - æ•°æ®æ ¼å¼å¼‚å¸¸æ—¶ä¼šè®°å½•è­¦å‘Šæ—¥å¿—
   - ç¼“å­˜è¯»å–å¤±è´¥æ—¶ä¼šè‡ªåŠ¨é‡æ–°è·å–æ•°æ®

4. **æ€§èƒ½ä¼˜åŒ–**:
   - æ™ºèƒ½ç¼“å­˜æœºåˆ¶å‡å°‘é‡å¤è¯·æ±‚
   - æ”¯æŒæ‰¹é‡æ•°æ®è·å–
   - å†…å­˜ä½¿ç”¨ä¼˜åŒ–ï¼ˆå¤§æ–‡ä»¶å¤„ç†æ—¶ï¼‰

## ğŸš€ åç»­æ‰©å±•

- [ ] å®ç° MockDataGetter ç”¨äºç¦»çº¿æµ‹è¯•
- [ ] æ·»åŠ æ›´å¤šæ•°æ®æºæ”¯æŒ
- [ ] å®Œå–„æ€»è‚¡æœ¬å’Œæµé€šè‚¡æœ¬æ•°æ®è·å–
- [ ] å¢åŠ æ•°æ®è´¨é‡æ ¡éªŒæœºåˆ¶
- [ ] æ”¯æŒå¼‚æ­¥æ•°æ®è·å–